1. Kiáº¿n trÃºc CHUáº¨N (ráº¥t quan trá»ng)

ğŸ‘‰ LUÃ”N bá»c QTableWidget trong QFrame
ğŸ‘‰ KHÃ”NG váº½ border ngoÃ i cho QTableWidget

QFrame (váº½ viá»n ngoÃ i giá»‘ng Excel)
 â””â”€â”€ QTableWidget (chá»‰ váº½ grid bÃªn trong)
      â”œâ”€â”€ viewport
      â”œâ”€â”€ header
      â””â”€â”€ scrollbar


â¡ï¸ Scrollbar khÃ´ng bao giá» che viá»n
â¡ï¸ KhÃ´ng redraw thá»«a â†’ khÃ´ng flicker

ğŸ¥‡ 2. Code CHUáº¨N â€“ Excel Style + MÆ°á»£t
ğŸ”¹ Táº¡o báº£ng
table = QTableWidget()
table.setRowCount(100000)
table.setColumnCount(10)

ğŸ”¹ Cáº¥u hÃ¬nh HIá»†U NÄ‚NG (báº¯t buá»™c)
from PyQt5.QtWidgets import QAbstractItemView

table.setShowGrid(True)

# Scroll mÆ°á»£t (QUAN TRá»ŒNG)
table.setVerticalScrollMode(QAbstractItemView.ScrollPerPixel)
table.setHorizontalScrollMode(QAbstractItemView.ScrollPerPixel)

# Táº¯t chá»‰nh sá»­a (giáº£m repaint)
table.setEditTriggers(QAbstractItemView.NoEditTriggers)

# Chá»n theo dÃ²ng (Excel style)
table.setSelectionBehavior(QAbstractItemView.SelectRows)
table.setSelectionMode(QAbstractItemView.SingleSelection)

# Táº¯t auto resize (ráº¥t tá»‘n CPU)
table.horizontalHeader().setSectionResizeMode(QHeaderView.Fixed)
table.verticalHeader().setSectionResizeMode(QHeaderView.Fixed)

table.verticalHeader().setDefaultSectionSize(24)


ğŸ‘‰ Náº¿u báº­t resizeColumnsToContents() = GIáº¾T HIá»†U NÄ‚NG

ğŸ¨ 3. StyleSheet â€“ Giá»‘ng Excel 90%
table.setStyleSheet("""
QTableWidget {
    background: white;
    gridline-color: #d0d0d0;
}

QTableWidget::item {
    padding: 4px;
    border-right: 1px solid #d0d0d0;
    border-bottom: 1px solid #d0d0d0;
}

QTableWidget::item:selected {
    background: #cce8ff;
    color: black;
}

QHeaderView::section {
    background: #f3f3f3;
    border: 1px solid #c0c0c0;
    padding: 4px;
    font-weight: bold;
}
""")


âœ” Grid máº£nh nhÆ° Excel
âœ” Header xÃ¡m nháº¡t
âœ” Chá»n dÃ²ng xanh nháº¡t

ğŸ§± 4. Bá»c QFrame â€“ FIX 100% máº¥t viá»n + flicker
frame = QFrame()
frame.setFrameShape(QFrame.Box)
frame.setLineWidth(1)

frame.setStyleSheet("""
QFrame {
    border: 1px solid #a0a0a0;
}
""")

layout = QVBoxLayout(frame)
layout.setContentsMargins(0, 0, 0, 0)
layout.addWidget(table)


ğŸ“Œ Viá»n nÃ y KHÃ”NG bao giá» máº¥t dÃ¹ scroll

âš¡ 5. Äá»• 100k dÃ²ng KHÃ”NG LAG (cá»±c quan trá»ng)

âŒ Sai láº§m phá»• biáº¿n:

for r in range(100000):
    for c in range(10):
        table.setItem(r, c, QTableWidgetItem("x"))  # âŒ ráº¥t cháº­m

âœ… CÃ¡ch ÄÃšNG
table.setUpdatesEnabled(False)

for r in range(100000):
    table.setItem(r, 0, QTableWidgetItem(str(r)))
    table.setItem(r, 1, QTableWidgetItem("Data"))

table.setUpdatesEnabled(True)


Hoáº·c tá»‘t hÆ¡n ná»¯a:
ğŸ‘‰ DÃ¹ng QTableView + QAbstractTableModel (náº¿u báº¡n cho phÃ©p)

ğŸ§  6. VÃ¬ sao cáº¥u hÃ¬nh nÃ y KHÃ”NG flicker?
NguyÃªn nhÃ¢n flicker	ÄÃ£ fix
Scroll theo item	âœ… PerPixel
Border váº½ láº¡i liÃªn tá»¥c	âœ… Giao cho QFrame
Auto resize cá»™t	âœ… Fixed
Update tá»«ng cell	âœ… setUpdatesEnabled(False)
ğŸ† TÃ“M Táº®T â€œCÃ”NG THá»¨C VÃ€NGâ€

âœ” QFrame váº½ viá»n ngoÃ i
âœ” QTableWidget chá»‰ váº½ grid
âœ” ScrollPerPixel
âœ” Fixed section size
âœ” KhÃ´ng auto resize
âœ” Táº¯t update khi Ä‘á»• dá»¯ liá»‡u

â¡ï¸ 100k dÃ²ng mÆ°á»£t â€“ khÃ´ng máº¥t viá»n â€“ khÃ´ng nháº¥p nhÃ¡y

Náº¿u báº¡n muá»‘n mÃ¬nh:

ğŸ”¥ NÃ¢ng cáº¥p sang QTableView + Model (siÃªu mÆ°á»£t)

ğŸ”¥ Dark mode Excel

ğŸ”¥ Freeze cá»™t Ä‘áº§u (giá»‘ng Excel)

ğŸ”¥ Lazy loading 1 triá»‡u dÃ²ng

ğŸ‘‰ nÃ³i mÃ¬nh dÃ¹ng PyQt5 / PyQt6 / PySide6 vÃ  layout hiá»‡n táº¡i, mÃ¬nh lÃ m tiáº¿p cho báº¡n.

QTableView + Model (siÃªu mÆ°á»£t)

Tuyá»‡t ğŸ‘ QTableView + Model lÃ  cÃ¡ch DUY NHáº¤T Ä‘Ãºng náº¿u báº¡n muá»‘n:

âœ… 100k â€“ 1 triá»‡u dÃ²ng mÆ°á»£t
âœ… KhÃ´ng flicker khi scroll
âœ… Viá»n giá»‘ng Excel
âœ… Tiáº¿t kiá»‡m RAM

DÆ°á»›i Ä‘Ã¢y lÃ  máº«u CHUáº¨N Sáº¢N XUáº¤T, mÃ¬nh viáº¿t ngáº¯n â€“ Ä‘Ãºng â€“ Ä‘á»§.

ğŸ§  Kiáº¿n trÃºc chuáº©n
QFrame (váº½ border ngoÃ i)
 â””â”€â”€ QTableView
       â””â”€â”€ QAbstractTableModel


ğŸ‘‰ View khÃ´ng giá»¯ dá»¯ liá»‡u
ğŸ‘‰ Model cáº¥p dá»¯ liá»‡u khi cáº§n
ğŸ‘‰ Qt chá»‰ render nhá»¯ng cell Ä‘ang nhÃ¬n tháº¥y

1ï¸âƒ£ Model â€“ SIÃŠU NHáº¸
from PyQt5.QtCore import Qt, QAbstractTableModel

class FastTableModel(QAbstractTableModel):
    def __init__(self, data, headers):
        super().__init__()
        self._data = data
        self._headers = headers

    def rowCount(self, parent=None):
        return len(self._data)

    def columnCount(self, parent=None):
        return len(self._headers)

    def data(self, index, role=Qt.DisplayRole):
        if not index.isValid():
            return None

        if role == Qt.DisplayRole:
            return self._data[index.row()][index.column()]

        return None

    def headerData(self, section, orientation, role):
        if role == Qt.DisplayRole:
            if orientation == Qt.Horizontal:
                return self._headers[section]
            return section + 1


ğŸ“Œ KhÃ´ng táº¡o QTableWidgetItem â†’ cá»±c nhanh

2ï¸âƒ£ View â€“ cáº¥u hÃ¬nh mÆ°á»£t
from PyQt5.QtWidgets import QTableView, QAbstractItemView, QHeaderView

table = QTableView()

table.setModel(model)

table.setShowGrid(True)

# Scroll mÆ°á»£t
table.setVerticalScrollMode(QAbstractItemView.ScrollPerPixel)
table.setHorizontalScrollMode(QAbstractItemView.ScrollPerPixel)

# Chá»n giá»‘ng Excel
table.setSelectionBehavior(QAbstractItemView.SelectRows)
table.setSelectionMode(QAbstractItemView.SingleSelection)

# Hiá»‡u nÄƒng
table.setEditTriggers(QAbstractItemView.NoEditTriggers)
table.setAlternatingRowColors(False)

# Header
table.horizontalHeader().setSectionResizeMode(QHeaderView.Fixed)
table.verticalHeader().setSectionResizeMode(QHeaderView.Fixed)
table.verticalHeader().setDefaultSectionSize(24)

3ï¸âƒ£ Style â€“ Excel look
table.setStyleSheet("""
QTableView {
    background: white;
    gridline-color: #d0d0d0;
}

QTableView::item {
    padding: 4px;
    border-right: 1px solid #d0d0d0;
    border-bottom: 1px solid #d0d0d0;
}

QTableView::item:selected {
    background: #cce8ff;
    color: black;
}

QHeaderView::section {
    background: #f3f3f3;
    border: 1px solid #c0c0c0;
    padding: 4px;
    font-weight: bold;
}
""")

4ï¸âƒ£ QFrame â€“ border ngoÃ i (KHÃ”NG BAO GIá»œ Máº¤T)
from PyQt5.QtWidgets import QFrame, QVBoxLayout

frame = QFrame()
frame.setFrameShape(QFrame.Box)
frame.setLineWidth(1)

frame.setStyleSheet("""
QFrame {
    border: 1px solid #a0a0a0;
}
""")

layout = QVBoxLayout(frame)
layout.setContentsMargins(0, 0, 0, 0)
layout.addWidget(table)

âš¡ 5ï¸âƒ£ Test 100k dÃ²ng (cháº¡y mÆ°á»£t)
data = [[f"Row {r}", f"Value {c}"] for r in range(100000) for c in range(2)]
headers = ["Name", "Value"]

model = FastTableModel(data, headers)
table.setModel(model)
'C02', 'KÃ½ hiá»‡u vá» sá»›m', 'Sm', 1
'C03', 'KÃ½ hiá»‡u Ä‘Ãºng giá»', 'X', 1
'C04', 'KÃ½ hiá»‡u tÄƒng ca', '+', 1
'C05', 'KÃ½ hiá»‡u thiáº¿u giá» ra', 'KR', 1
'C06', 'KÃ½ hiá»‡u thiáº¿u giá» vÃ o', 'KV', 1
'C07', 'KÃ½ hiá»‡u váº¯ng (máº·c Ä‘á»‹nh khÃ´ng cháº¥m cÃ´ng)', 'V', 1
'C08', 'KÃ½ hiá»‡u Ä‘Ãºng giá» ca cÃ³ qua Ä‘Ãªm', 'Ä', 1
'C09', 'KÃ½ hiá»‡u ngÃ y khÃ´ng xáº¿p ca', 'OFF', 1
'C10', 'KÃ½ hiá»‡u nghá»‰ lá»…', 'Le', 1